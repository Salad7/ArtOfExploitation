#include <stdio.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <netinet/ip.h>
#include <string.h>
/*
Client - Acts as the de-facto source for sending to the host
*/

#define PORT 7890
//Creating an Enum for booleans because my version C doesn't support boolean
enum booleans {TRUE, FALSE};



//Method that will return TRUE if socket is created, false otherwise
enum booleans createSocket(int* __socket){
	*__socket = socket(AF_INET,SOCK_STREAM,0);
	if(*socket < 0){
		return FALSE;
	}
	return TRUE;
};

enum booleans connectSocket(int* __socket, struct sockaddr_in socketAddress){
//Create the sockaddr_in wrapper to send data
	socketAddress.sin_family = AF_INET;
	socketAddress.sin_port = htons(PORT);
	socketAddress.sin_addr.s_addr = 0;
	int con = connect(*__socket,(struct sockaddr*)&socketAddress,sizeof(socketAddress));
	if(con < 0){
		printf(" error connecting to socket");
		return FALSE;
	}
	return TRUE;
}

enum booleans bindSocket(int* __socket, struct sockaddr_in* socketAddress){
	//Create the sockaddr_in wrapper to send data
	socketAddress->sin_family = AF_INET;
	socketAddress->sin_port = htons(PORT);
	socketAddress->sin_addr.s_addr = 0;
	int bindIn = bind(*__socket, (struct sockaddr*)socketAddress,sizeof(struct sockaddr));
	memset(&(socketAddress->sin_zero),'\0',8);
	if(bindIn < 0){
				printf(" error binding to socket result: %d",bindIn);

		return FALSE;
	}

	return TRUE;
}

enum booleans listenSocket(int* __socket){
int listenIn = listen(*__socket,1);
if(listenIn < 0){
	return FALSE;
}
return TRUE;
}

void acceptSocket(int* __socketHost, struct sockaddr_in* socketAddressHost){
	createSocket(__socketHost);
	while(1){
	int acceptIn = accept(*__socketHost,(struct sockaddr*)socketAddressHost,sizeof(struct sockaddr_in));
		if(acceptIn == -1){
			printf("Error\n");
			break;
		}
		}	
}


int main(){

int socket, socketHost;
struct sockaddr_in socketAddress, socketAddressHost;

//Checking if socket is valid
if(createSocket(&socket) == TRUE){
		//Check to see if socket has binded to local address
		if(bindSocket(&socket,&socketAddress) == TRUE){
			if(listenSocket(&socket) == TRUE){
				printf("success");
				acceptSocket(&socketHost,&socketAddressHost);
			}
		}

}


}


